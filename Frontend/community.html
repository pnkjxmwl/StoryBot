<!DOCTYPE html>
<html>
<head>
  <title>Community Stories</title>
</head>
<body>
  <nav id="navbar" style="display: block;">
    <ul>
      <li><a id="communityButton" href="#">Community</a></li>
      <li><a id="profileButton" href="file:///D:/PROGRAM/Projects/StoryBot/Frontend/main.html">Profile</a></li>
      <li><button id="logoutButton">Logout</button></li>
    </ul>
  </nav>
  <h1>Community Stories</h1>
  <div id="communityStoriesContainer"></div>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script>
    axios.get('http://127.0.0.1:4000/api/v1/stories')
      .then((response) => {
        console.log(response);
        console.log(response);
        const communityStoriesContainer = document.getElementById('communityStoriesContainer');

        response.data.data.forEach((story) => {
          const storyDiv = document.createElement('div');
          storyDiv.classList.add('story-box');

          const userTag = document.createElement('h3');
          userTag.textContent = "by "+story.userId.name;

          const titleTag = document.createElement('h2');
          titleTag.textContent = story.title;

          const imgTag = document.createElement('img');
          imgTag.setAttribute('src', story.images[0]);
          imgTag.setAttribute('alt', 'Story Image');

          storyDiv.appendChild(titleTag);
          storyDiv.appendChild(userTag);
          storyDiv.appendChild(imgTag);

          // Add click event listener to each story box
          storyDiv.addEventListener('click', () => {
            // Redirect to story.html with the story ID as a query parameter
            window.location.href = `file:///D:/PROGRAM/Projects/StoryBot/Frontend/story.html?storyId=${story._id}`;
          });

          communityStoriesContainer.appendChild(storyDiv);
        });
      })
      .catch((error) => {
        console.log(error);
      });

      document.getElementById('logoutButton').addEventListener('click', () => {
      // Clear the JWT token from localStorage to log the user out
      localStorage.removeItem('jwtToken');
  
      // Redirect to the main page (index.html) after logout
      window.location.href = 'file:///D:/PROGRAM/Projects/StoryBot/Frontend/main.html';
    });
  </script>
  <style>
    .story-box {
      cursor: pointer;
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 20px;
    }

    .story-box img {
      max-width: 100%;
    }
  </style>
</body>
</html>
